<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Jocul Cuvintelor - Jucător</title>
    <link rel="stylesheet" href="/static/tv.css">
    <style>
        @import url('/pictures/logo.png'); /* noop to avoid CSP warnings if any */
    </style>
</head>
<body>
    <div class="tv-wrap">
        <div class="tv-header">
            <img src="/pictures/logo.png" alt="Jocul Cuvintelor" />
        </div>
        <div class="tv-panel">
            <div class="tv-row" style="font-size:22px; margin-bottom:10px">
                <span id="player-name" class="chip">Așteptare jucător...</span>
                <span class="timer" id="main-timer">4:00</span>
                <span class="score" id="player-score">0 lei</span>
            </div>
            <div class="tv-def" id="definition-text">Așteptare cuvânt...</div>
            <div class="tv-big" id="word-placeholder">&nbsp;</div>
            <div class="tv-row" style="margin-top:14px">
                <span id="answer-timer-display" class="chip" style="min-width:220px; text-align:center"></span>
                <span id="feedback-message" style="flex:1; text-align:center"></span>
            </div>
        </div>
        <div style="margin-top:14px; text-align:center; opacity:0.8; font-size:14px">
            Butonul Roșu se află pe telefon: <a href="/buton-rosu" target="_blank">/buton-rosu</a>
        </div>
    </div>
    
    <div class="message-overlay" id="message-overlay"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();

        // Auto-reload on server notification (dev convenience)
        socket.on('reload', () => {
            window.location.reload();
        });

        // Elementele DOM
        const playerNameEl = document.getElementById('player-name');
        const mainTimerEl = document.getElementById('main-timer');
        const scoreEl = document.getElementById('player-score');
        const definitionEl = document.getElementById('definition-text');
        const wordEl = document.getElementById('word-placeholder');
        const feedbackEl = document.getElementById('feedback-message');
        const messageOverlay = document.getElementById('message-overlay');
        const answerTimerDisplay = document.getElementById('answer-timer-display');
    // Butonul Roșu nu mai există aici

        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

    // Butonul Roșu a fost mutat pe o pagină separată (accesată de pe telefon)

        // --- Evenimente primite de la server ---
        socket.on('update_jucator', (data) => {
            playerNameEl.textContent = data.jucator_curent;
            scoreEl.textContent = `${data.scor} lei`;
            definitionEl.textContent = data.definitie;
            wordEl.textContent = data.litere_afisate.join(' ');
            
            // Logica de blocare/deblocare butoane
            const butoane = data.stare_butoane.jucator;
            // Butonul pentru literă a fost mutat la prezentator. Butonul roșu e pe /buton-rosu.

            if (data.stare_butoane.prezentator.validare) {
                feedbackEl.innerHTML = `<i>Așteptare validare răspuns...</i>`;
            } else if (data.definitie) {
                feedbackEl.innerHTML = `Valoare cuvânt: <b>${data.valoare_ramasa} lei</b>`;
            } else {
                 feedbackEl.innerHTML = "";
            }
        });

        socket.on('update_timer', (data) => {
            if (data.type === 'main') {
                mainTimerEl.textContent = formatTime(data.time);
                answerTimerDisplay.textContent = '';
            } else if (data.type === 'answer') {
                answerTimerDisplay.textContent = `Timp Răspuns: ${data.time}`;
            }
        });

        socket.on('show_message', (message) => {
            messageOverlay.innerHTML = message;
            messageOverlay.style.display = 'flex';
            setTimeout(() => {
                messageOverlay.style.display = 'none';
            }, 4000);
        });

        socket.on('show_feedback', (data) => {
            answerTimerDisplay.textContent = '';
            if (data.corect) {
                feedbackEl.innerHTML = `<span style="color: #2ecc71;">CORECT! Cuvântul a fost: ${data.cuvant}</span>`;
            } else {
                feedbackEl.innerHTML = `<span style="color: #e74c3c;">${data.mesaj} Cuvântul corect era: ${data.cuvant}</span>`;
            }
        });

    socket.on('game_over', (data) => {
            document.querySelector('.container').innerHTML = '<h1>Joc Terminat!</h1>';
            const scoresContainer = document.createElement('div');
            let scoresHtml = '<h2>Clasament Final</h2><ul style="list-style:none; padding:0; font-size:1.5em;">';
            const sortedScores = Object.entries(data.scoruri).sort(([,a],[,b]) => b-a);
            for (const [player, score] of sortedScores) {
                scoresHtml += `<li>${player}: ${score} lei</li>`;
            }
            scoresHtml += '</ul>';
            scoresContainer.innerHTML = scoresHtml;
            document.querySelector('.container').appendChild(scoresContainer);
        });
    </script>
</body>
</html>